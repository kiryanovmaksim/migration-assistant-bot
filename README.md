# TeamMeet Bot

Телеграм-бот для проведения командных встреч с поддержкой:
- **Аутентификации по логину/паролю**
- **Ролевой модели** (Администратор, Модератор, Участник)
- **CRUD операций с ролями и встречами**
- **Вопросов внутри встреч** и сбора ответов
- **Защиты команд по ролям**
- **Клавиатуры с быстрыми командами**

## Архитектура

```
bot/
 ├── app/              # Логика бота
 │   ├── bot.py        # Команды и обработчики
 │   ├── repo.py       # Слой доступа к БД (CRUD, auth, sessions)
 │   ├── models.py     # SQLAlchemy модели
 │   ├── db.py         # Подключение к БД
 │   ├── utils.py      # Декораторы, проверки прав
 │   └── config.py     # Настройки (.env)
 ├── data/
 │   ├── bot.db        # Основная база
 │   ├── test.db       # Тестовая база
 │   └── init.sql      # Скрипт инициализации (роли, пользователи, тестовые встречи)
 ├── tests/            # Pytest-тесты
 └── run.py            # Точка входа для запуска бота
```

## Установка и запуск

### Локально

1. Клонируем репозиторий:
   ```bash
   git clone https://github.com/kiryanovmaksim/migration-assistant-bot.git
   cd migration-assistant-bot
   ```

2. Создаём виртуальное окружение:
   ```bash
   python -m venv venv
   venv\Scripts\activate    # Windows
   source venv/bin/activate # Linux/Mac
   ```

3. Устанавливаем зависимости:
   ```bash
   pip install -r requirements.txt
   ```

4. Запускаем бота:
   ```bash
   python run.py
   ```

### На PythonAnywhere

1. Загружаем код на сервер.
2. Создаём виртуальное окружение:
   ```bash
   mkvirtualenv --python=/usr/bin/python3.11 teammeet_env
   pip install -r requirements.txt
   ```
3. Настраиваем WSGI в `launchApp/webapp.py`:
   ```python
   from webapp import app as application
   ```
4. Перезапускаем приложение через панель управления.

## Авторизация

Для входа используйте команды:

- Администратор:  
  ```
  /login admin admin123
  ```
- Модератор:  
  ```
  /login moderator mod123
  ```
- Участник:  
  ```
  /login user1 user123
  ```

## Основные команды

| Команда            | Роль            | Описание |
|--------------------|-----------------|----------|
| `/start`           | Все             | Приветствие, проверка авторизации |
| `/login <u> <p>`   | Все             | Авторизация |
| `/whoami`          | Все             | Показ текущего пользователя |
| `/roles`           | Админ           | Список ролей |
| `/addrole`         | Админ           | Создание новой роли |
| `/renamerole`      | Админ           | Переименование роли |
| `/delrole`         | Админ           | Удаление роли |
| `/setrole`         | Админ           | Назначение роли пользователю |
| `/meetings`        | Все             | Список встреч |
| `/openmeeting <id>`| Модератор/Админ | Открыть встречу |
| `/closemeeting <id>`| Модератор/Админ| Закрыть встречу |
| `/questions <id>`  | Все             | Просмотр вопросов встречи |
| `/answer <id> <текст>` | Участник | Ответить на вопрос |

## Тест-кейсы

### 1. Авторизация
- ✅ `/login admin admin123` → Успешный вход (роль: Администратор)
- ✅ `/login moderator mod123` → Успешный вход (роль: Модератор)
- ✅ `/login user1 user123` → Успешный вход (роль: Участник)
- ❌ `/login wrong wrong` → Ошибка «Неверный логин или пароль»

### 2. Проверка ролей
- Админ: может выполнять `/roles`, `/addrole`, `/setrole`
- Модератор: доступ к `/meetings`, открытию/закрытию встреч
- Участник: доступ только к `/meetings`, `/questions`, `/answer`

### 3. Встречи
1. `/meetings` → список доступных встреч  
2. `/openmeeting 1` (модератор/админ) → статус «открыта»  
3. `/questions 1` → вывод вопросов встречи  
4. `/answer 1 Тестовый ответ` (участник) → сохраняется ответ  
5. `/closemeeting 1` → встреча закрыта  

### 4. Безопасность
- Участник пробует `/addrole` → «Недостаточно прав»
- Модератор пробует `/setrole` → «Недостаточно прав»
